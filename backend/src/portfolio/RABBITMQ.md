# RabbitMQ 비동기 & 데드레터 처리

태그: PORTFOLIO
날짜: 2024년 3월 15일
참여자: 진주원, 김승진

## 문제 상황 & 접근

---

1. FCM 오류 처리

> 그룹 초대 , 친구 요청 서비스를 수행하는데 있어 FCM을 사용했다. FCM 자체의 성능 개선을 위해 RabbitMQ을 사용함. FCM 요청에 있어 오류가 발생할 경우 처리를 위해 데드레터 처리
>
1. 비동기 적용

> FCM 자체는 동기방식이기 때문에 짧은 시간에 많은 요청이 수행되는 경우 성능상  개선 필요, 메시지 큐를 사용하여 비동기 방식으로 처리
>

### 적용

---

![Untitled](RabbitMQ%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20&%20%E1%84%83%E1%85%A6%E1%84%83%E1%85%B3%E1%84%85%E1%85%A6%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20d6e603faa06044fc98e0befcf55c62e5/Untitled.png)

- 알림을 위한 RabbitMQ queue에서 발생한 오류는 데드레터로 메시지가 전달되도록 연결하였다.

![스크린샷 2024-03-15 오후 10.49.00.png](RabbitMQ%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20&%20%E1%84%83%E1%85%A6%E1%84%83%E1%85%B3%E1%84%85%E1%85%A6%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20d6e603faa06044fc98e0befcf55c62e5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-03-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_10.49.00.png)

- 데드레터가 발생한 경우 상단의 RabbitListener로 전송된다.
- RabbitMQ는 데드레터를 데드레터 큐에 추가한다.
- 이후 로깅을 수행한 이후 개발자의 Slack으로 알림을 전송한다.

### 결론

---

## 데드레터 발생시 슬랙 알림

![스크린샷 2024-03-15 오후 7.19.13.png](RabbitMQ%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20&%20%E1%84%83%E1%85%A6%E1%84%83%E1%85%B3%E1%84%85%E1%85%A6%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20d6e603faa06044fc98e0befcf55c62e5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-03-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_7.19.13.png)

## RabbitMQ Management에서 확인한 데드레터 현황

![스크린샷 2024-03-15 오후 7.17.10.png](RabbitMQ%20%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%20&%20%E1%84%83%E1%85%A6%E1%84%83%E1%85%B3%E1%84%85%E1%85%A6%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20d6e603faa06044fc98e0befcf55c62e5/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-03-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_7.17.10.png)
